{# templates/teacher/attendance.html.twig #}
{% extends 'student/base.html.twig' %}

{% block content %}
	<h1 class="text-2xl font-bold mb-6">Registrar Asistencia:
		{{ course.name }}</h1>
	<p class="mb-4 text-gray-600">Fecha:
		{{ date|date('d/m/Y') }}</p>

	<form method="post" action="{{ path('teacher_attendance_save', {id: course.id}) }}">
		<input type="hidden" name="date" value="{{ date|date('Y-m-d') }}">

		<div class="overflow-x-auto">
			<table class="min-w-full bg-white border">
				<thead>
					<tr class="bg-gray-100">
						<th class="py-2 px-4 text-left">Alumno</th>
						<th class="py-2 px-4 text-left">Asistencia</th>
					</tr>
				</thead>
				<tbody>
					{% for student in students %}
						<tr class="border-t">
							<td class="py-2 px-4">{{ student.email }}</td>
							<td class="py-2 px-4">
								<select
									name="status[{{ student.id }}]" class="border rounded px-2 py-1">
									{# CORRECCIÓN: Usar el operador Null Coalescing (??) para evitar errores de clave no definida. #}
									<option value="present" {% if (attendanceMap[student.id] ?? 'none') == 'present' %} selected {% endif %}>Presente</option>
									<option value="absent" {% if (attendanceMap[student.id] ?? 'none') == 'absent' %} selected {% endif %}>Ausente</option>
									<option value="justified" {% if (attendanceMap[student.id] ?? 'none') == 'justified' %} selected {% endif %}>Justificado</option>
								</select>
								<input type="hidden" name="student_ids[]" value="{{ student.id }}">
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<button type="submit" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
			Guardar asistencia
		</button>
	</form>

	<a href="{{ path('teacher_courses') }}" class="mt-4 inline-block text-blue-600 hover:underline">← Volver a mis cursos</a>


{% endblock %}
